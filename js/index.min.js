var current_page,activity_message,messages_check,current_convo,content_id,field_count=0,loading=!1,reply_id=!1,repost_id=!1,thread_id=!1,version="v1",original_title=document.title;if(!emojis)var emojis=!1;function addImage(e){if($(".attach-media").fadeIn(),$("#new-post-image").val()){var t=$("#new-post-image").val()+","+e;$("#new-post-image").val(t)}else $("#new-post-image").val(e);$(".attach-media").append("<div class='media-item' data-background='"+e+"'><div class='remove-media' data-url='"+e+"'></div></div>"),$(".remove-media").on("click",function(e){var t=removeValue($("#new-post-image").val(),$(this).attr("data-url")),a=$(this).attr("data-url");$("#new-post-image").val(t),$(".media-item[data-background='"+a+"']").remove(),$(".attach-media > .media-item").length||$(".attach-media").fadeOut()}),lazyLoad()}function addMessage(e,t,a=!1){a?$("[data-convo="+t+"]").append("<div class='message-placeholder sending' id='mplaceholder-"+e+"'><div class='message-container sender-container' id='message-"+e+"'><div class='message-item message-sender' id='message-"+e+"'>"+a+"</div><div class='message-timestamp'>Sending...</div></div></div>"):$.ajax({type:"POST",url:"/backend",data:{action:"getMessage",id:e,convo:t},success:function(t){"error"!==t&&($("#mplaceholder-"+e).html(t),$("#mplaceholder-"+e).removeClass("sending"),scrollMessages())},error:function(e){console.log("error getting message")}})}function scrollMessages(){var e=$(".messages-container");e.scrollTop(e.prop("scrollHeight"))}function resetPost(){$("#content").val(""),$("#limit-content").html("0 / 500"),$(".attach-media").html(""),$(".attach-media").fadeOut(),$(".post-privacy").show(),$(".reply-privacy").hide(),$("#new-post-image").val("")}function resetDM(){userSearch(),$("#user-search").val(""),$("#convo-users").val(""),$(".new-convo-btn").prop("disabled",!0),$("#usersearch-error").fadeOut()}function refreshPrivacy(e=!1){$.ajax({type:"POST",url:"/backend",data:{action:"privacy",public:e},success:function(e){$(".post-privacy").html(e),$("select#post-privacy").val()?$("select#post-privacy").val(""):$("select#post-privacy").val("1"),$(".toggle-privacy").click(function(){$("#post-privacy").val()?index=0:index=1,refreshPrivacy(index)})},error:function(e){console.log("error getting privacy status")}})}function modals(e){$(".modal:not(#"+e+")").is(":visible")&&($($(".modal:not(#"+e+")").is(":visible")).removeClass("scale"),$($(".modal:not(#"+e+")").is(":visible")).fadeOut(),$(".modals-container").fadeOut()),"new-post"===e&&refreshPrivacy(),$("html,body").toggleClass("hinder"),$(".modal#"+e).hasClass("scale")?($(".modal#"+e).toggleClass("scale",{duration:30,easing:"easeInOutQuart"}),setTimeout(function(){$(".modal#"+e).fadeToggle({duration:100}),$(".modals-container").fadeToggle()},10)):($(".modal#"+e).fadeToggle({duration:100}),setTimeout(function(){$(".modal#"+e).toggleClass("scale",{duration:30,easing:"easeInOutQuart"})},10),$(".modals-container").css("display","flex"),"new-post"===e&&$("#content").focus())}function modalSwitch(e,t){modals(e),setTimeout(function(){modals(t)},500)}function changeIcon(e){var t=document.createElement("link"),a=document.getElementById("dynamic-favicon");t.id="dynamic-favicon",t.rel="shortcut icon",t.href=e,a&&document.head.removeChild(a),document.head.appendChild(t)}$.ajaxSetup({cache:!1}),$(window).on("load",function(){activate(current_page),lazyLoad(),userSearch(),changeIcon("/img/icon.png"),setTimeout(function(){$(".site-progress").fadeOut()},1e4),setTimeout(function(){$(".preload").fadeOut(),$("body").removeClass("hinder")},1e3)}),$(function(){!getCookie("back")&&getCookie("session")||$("body").removeClass("hinder"),eraseCookie("back"),loadFont("Ubuntu"),$.ajax({type:"POST",url:"/backend",data:{action:"languages"},success:function(e){$(".lang-list").html(e)},error:function(e){console.log("error loading languages"),$(".lang-list").html("<div class='empty-state-message'>"+t("Error loading languages.")+"</div>")}}),getCookie("session")&&setInterval(function(){$.ajax({type:"POST",url:"/api/"+version+"/checkLimit",dataType:"json",success:function(e){var t=e.status,a=e.message;$("#limit-status").html(a),"reached"===t?(modals("unplug"),newAlert(a)):"logout"===t&&(window.location="/accounts/logout")},error:function(e){console.log("limit error"),$("#limit-status").html(t("Error checking time limit."))}}),$.ajax({type:"POST",url:"/api/"+version+"/checkActivity",dataType:"json",success:function(e){var t=e.status,a=e.message;if(console.log(t),"new"===t){$(".nav-btn-activity").addClass("new-activity"),changeIcon("/img/alerts.png");var o=a.match(/(\d+)/);document.title="("+o[0]+") "+original_title,activity_message!==a&&(activity_message=a,newAlert(a))}else $(".nav-btn-activity").removeClass("new-activity"),changeIcon("/img/icon.png"),document.title=original_title},error:function(e){console.log("activity error")}})},5e3),setInterval(function(){},1e4),emojis||$(".back-link").on("click",function(e){window.location="/"}),$("#gif-search").on("change",function(e){$("#gifs-error").fadeOut();var a=$(this).val();a&&$.ajax({type:"POST",url:"/backend",data:{action:"gifs",query:a},success:function(e){e?($(".gif-results").html(e),lazyLoad(),$(".gif-item").click(function(){addImage($(this).attr("data-gif")),modalSwitch("attach-gif","new-post")})):$(".gif-results").html(t("No clever GIFs for")+" '"+a+"'.")},error:function(e){$("#gifs-error").fadeIn()}})}),$("#user-search").on("change",function(e){userSearch()}),$("#convo-users").on("change",function(e){$(this).val()?$(".new-convo-btn").prop("disabled",!1):$(".new-convo-btn").prop("disabled",!0)}),$("#quick-search").on("keyup",function(e){var t=$(this).val();t?($(".search-results").fadeIn(),$.ajax({type:"POST",url:"/backend",data:{action:"search",query:t},success:function(e){$(".search-results").html(e),$(".search-results .quick-search-item").click(function(){var e=$(this).text();$.ajax({type:"POST",url:"/api/"+version+"/querySave",data:{query:t,final:e},success:function(e){},error:function(e){console.log("error saving query")}})}),activate()},error:function(e){console.log("error searching")}})):$(".search-results").fadeOut()}),$(".photo-btn").click(function(){$("#postUpload").click()}),$("#postUpload").change(function(){var e=new FormData,a=$("#postUpload")[0].files[0];e.append("action","posts"),e.append("file",a);var o=new XMLHttpRequest;o.open("POST","/img/upload",!0),$(":input, :button").prop("disabled",!0),$(".indeterminate").hide(),$(".determinate").show(),$(".upload-photo").show(),o.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;$(".progress-text").html("Uploading..."+Math.round(t)+"%"),$(".determinate").css("width",Math.round(t)+"%")}},o.onload=function(){if(200===this.status){var e=this.responseText;if($(":input, :button").prop("disabled",!1),$(".upload-photo").hide(),console.log(e),"badext"===e)var a="Only .jpeg, .png and .gif files are allowed.";else if("toolarge"===e)a="Your file is too large for us (yourimage > 500 MB)";else if(e.includes("error"))a="We couldn't upload that photo for some reason, please try again later.";else{a="Photo uploaded!";addImage("/img/posts/"+e)}newAlert(t(a)),activate()}else console.log("goofed"),$(":input, :button").prop("disabled",!1),$(".upload-photo").hide(),newAlert(t("We couldn't upload that photo for some reason, please try again later."))},o.send(e)}),$(".set-limit-btn").click(function(){$("#limit-error").fadeOut();var e=$("select#limit-range option:selected").val(),a=$("#logout").prop("checked");$(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/api/"+version+"/limit",dataType:"json",data:{limit:e,logout:a},success:function(e){var t=e.status,a=e.message;$(":input, :button").prop("disabled",!1),"success"===t?(modals("limit"),newAlert(a)):($("#limit-error").html(a),$("#limit-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#limit-error").html(t("Error setting limit, please try again later.")),$("#limit-error").fadeIn()}})}),$("#password").on("input",function(){var e=$("#password").val(),a=($("#passwordconfirm").val(),document.getElementById("password-strength-meter")),o=zxcvbn(e);a.value=o.score,""!==e?$(".password-strength").html(t({0:"Keep going...",1:"Not a safe password. Add a number and a special character.",2:"It could be better. Add another number or a special character.",3:"A fair password.",4:"A truly divine password!"}[o.score])):$(".password-strength").html(t("Use at least 8 characters, 1 number and 1 special character."))}),$({property:0}).animate({property:105},{duration:4e3,step:function(){var e=Math.round(this.property);$(".site-progress").css("width",e+"%"),100==e&&($(".site-progress").addClass("progress-done"),$(".site-progress").remove())},complete:function(){}}),$("#login-form").on("submit",function(e){e.preventDefault(),$("#login-error").fadeOut(),$(".require-error").fadeOut(),$(".login-inputs").removeClass("wrong-password");var t=checkInputs(this.id),a=checkCount(this.id),o=$("form#"+this.id).serialize();!0===t&&!0===a?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:o,success:function(e){"go"===e?window.location="/":($(":input, :button").prop("disabled",!1),$("#login-error").html(e),$("#login-error").fadeIn(),"Incorrect Password"===e&&$(".login-inputs").addClass("wrong-password"),$("iframe").attr("src",$("iframe").attr("src")))},error:function(e){$(":input, :button").prop("disabled",!1),$("#login-error").html("Error logging you in, please try again later."),$("#login-error").fadeIn()}})):($(":input, :button").prop("disabled",!1),console.log("Required inputs are empty or an input is beyond it's character limit")),e.preventDefault()}),$("#signup-form").on("submit",function(e){e.preventDefault(),$("#signup-error").fadeOut();var t=checkInputs(this.id),a=checkCount(this.id),o=$("form#"+this.id).serialize();!0===t&&!0===a?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:o,success:function(e){$(":input, :button").prop("disabled",!1),"go"===e?window.location="/settings/privacy":($("#signup-error").html(e),$("#signup-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#signup-error").html("Backend error creating your account."),$("#signup-error").fadeIn()}})):(console.log("Required inputs are empty or an input is beyond it's character limit"),$(":input, :button").prop("disabled",!1)),e.preventDefault()}),$("body").on("click",function(e){$(".search-results").fadeOut()}),$("#new-post-form").on("submit",function(e){e.preventDefault(),$("#newpost-error").fadeOut();var t=checkInputs(this.id),a=checkCount(this.id),o=$("form#"+this.id).serialize();!1!==reply_id&&(o+="&reply="+reply_id),!1!==repost_id&&(o+="&repost="+repost_id),!1!==thread_id&&(o+="&thread="+thread_id),!0===t&&!0===a?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/api/"+version+"/newPost",data:o,dataType:"json",success:function(e){var t=e.status,a=e.message;$(":input, :button").prop("disabled",!1),"success"===t?("home"===current_page&&content(".posts-container","feed","type=home&weeks=1"),"thread"===current_page&&content("#thread-replies","feed","type=thread&thread="+content_id+"&weeks=1"),"post"===current_page&&content(".posts-container","feed","type=replies&post="+content_id+"&weeks=1"),newAlert(a),modals("new-post"),reply_id=!1,repost_id=!1,thread_id=!1,$("#content").val(""),$(".modal#new-post h2").html("New Post"),$(".ref-post").html("")):($("#newpost-error").html(a),$("#newpost-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#newpost-error").html("Something went wrong sending this post."),$("#newpost-error").fadeIn()}})):(console.log("Required inputs are empty or an input is beyond it's character limit"),$(":input, :button").prop("disabled",!1)),e.preventDefault()}),$(".dropdown").each(function(){$(this).append("<div class='dropdown-divider'></div><ul><li class='cancel-opt'>"+t("Close")+"</li></ul>")}),$(".new-convo-btn").click(function(){var e=$("#convo-users").val();e&&$.ajax({type:"POST",url:"/api/"+version+"/newConvo",dataType:"json",data:{users:e},success:function(e){var t=e.status,a=e.message;"success"===t?(load("messages","id="+a,"messages/"+a),modals("new-dm"),resetDM()):($("#usersearch-error").html(a),$("#usersearch-error").fadeIn())},error:function(e){console.log("error creating new convo"),$("#usersearch-error").html("There was an error creating a new conversation."),$("#usersearch-error").fadeIn()}})}),$(window).on("popstate",function(e){setCookie("back",!0,1),location.reload()})}),document.head=document.head||document.getElementsByTagName("head")[0];const loadFont=e=>{e="https://fonts.googleapis.com/css?family="+e+":400,500,600,700";var t=new XMLHttpRequest;t.open("GET",e,!0),t.onreadystatechange=(()=>{if(4==t.readyState&&200==t.status){let e=t.responseText;e=e.replace(/}/g,"font-display: swap; }");const a=document.getElementsByTagName("head")[0],o=document.createElement("style");o.appendChild(document.createTextNode(e)),a.appendChild(o)}}),t.send()};function runtooltips(){$("body").tooltip({selector:"[data-toggle=tooltip]",trigger:"hover",container:"body"})}function openVideo(e,t){$(".post-link-block#"+e).hide(),$("#frame"+e+" iframe").attr("src","https://youtube.com/embed/"+t+"?autoplay=1"),$("#frame"+e).show()}function updateLimits(e){var t=$(e).val().length,a=$(e).attr("data-limit");t>a/2&&t<a?($(this).removeClass("require-input"),$("#limit-"+e.id).addClass("limit-almost"),$("#limit-"+e.id).removeClass("limit-reached")):t>a?($(this).addClass("require-input"),$("#limit-"+e.id).addClass("limit-reached")):($(this).removeClass("require-input"),$("#limit-"+e.id).removeClass("limit-reached"),$("#limit-"+e.id).removeClass("limit-almost")),$("#limit-"+e.id).html(t+" / "+a)}var confirmunload;function load(e,t,a){if(!1===loading){var o;if(!0===confirmunload)!0===confirm("Are you sure you want to leave? Any unsaved changes will be lost.")?o=!0:(o=!1,setTimeout(function(){$(".active-tab").removeClass("active-tab")},50));else o=!0;if(!0===o&&("create-thread"===e?(confirmunload=!0,window.onbeforeunload=function(){return!0}):(window.onbeforeunload=null,confirmunload=!1),e&&(e!==current_page||"post"===e||"profile"===e||"messages"===e))){loading=!0,current_page=e;var n=t=t;"home"===e&&(a="/"),a||(a="/"+e),t=t?t+"&action="+e:"action="+e,$(".left-container").html("<div class='inline-loading'><div class='load'></div></div>"),$.ajax({type:"POST",url:"/page",data:t,success:function(t){loading=!1,$(".left-container").html(t),activate(e),setTitle(e,n),window.history.pushState({page:e},e,a),$("html, body").animate({scrollTop:$(".page-container").offset().top-150},"fast"),"messages"!==e&&($("body").removeClass("hinder"),$(".new-post").fadeIn(),clearInterval(messages_check))},error:function(e){console.log(e),$(".left-container").html("<div class='content-block'>Error getting page...</div>")}}),$(".right-container").length&&(t=t?n+"&action=side&main="+e:"action=side&main="+e,$.ajax({type:"POST",url:"/page",data:t,success:function(t){$(".right-container").html(t),activate(e),content(".trending-container","threads","type=trending")},error:function(e){console.log(e),$(".right-container").html("<div class='content-block'>Error</div>")}}))}}}function setTitle(e,t){t=t?t+"&page="+e:"page="+e,t+="&simple=true",$.ajax({type:"POST",url:"/metadata",data:t,success:function(e){document.title=e+" - Pengin",original_title=e+" - Pengin"},error:function(e){console.log("Error setting page title...")}})}function content(e,t,a){$(e).html()||$(e).html("<div class='inline-loading'><div class='load'></div></div>"),a+="&action="+t,$.ajax({type:"POST",url:"/backend",data:a,success:function(a){$(e).html(a),activate(t)},error:function(t){$(e).html("<div class='content-block'>Error loading content...</div>"),console.log(t)}})}function activate(e){lazyLoad(),$(".tooltip").remove(),$("[data-action],[data-modal],[data-activity],[data-dropdown],[data-copy],.reply-btn,.repost-btn,.send-msg-btn,.mask-btn,.lang-item").unbind(),$("input, textarea").each(function(){updateLimits(this)}),$(".lang-item").on("click",function(e){newAlert(t("Changing Language")+"..."),$("#edit-val-language").val($(this).attr("data-code")),saveEdit("language",!0),setTimeout(function(){window.location=window.location.href},1e3)}),$(".mask-btn").click(function(){$(this).toggleClass("mask-show"),"password"===$("#password").attr("type")?$("#password").prop("type","text"):$("#password").prop("type","password")}),$("input, textarea").on("input",function(){updateLimits(this)}),$("[data-modal]").click(function(){var e=$(this).attr("data-modal");$(".modal#"+e).length?modals(e):console.log("Modal '"+e+"' doesn't exist.")}),$("[tooltip]").each(function(){var e=$(this).attr("tooltip");$(this).attr("data-toggle","tooltip"),$(this).attr("data-original-title",e),ismobile||runtooltips()}),$("input[name=showdetails]").on("change",function(){for(var e=document.getElementsByName("showdetails"),t="",a=0,o=e.length;a<o;a++)e[a].checked&&(t+=e[a].value+",");t=t.replace(/,$/,""),$("#edit-val-showdetails").val(t),saveEdit("showdetails",!0)}),$("[data-action]").click(function(){var e=$(this).attr("data-action"),t=$(this).attr("data-args"),a=$(this).attr("data-url");"profile"!==(e=$(this).attr("data-action"))&&"post"!==e&&"thread"!==e||$(".active-tab").removeClass("active-tab"),load(e,t,a)}),$(".navigation-logo").click(function(){$(".active-tab").removeClass("active-tab"),$("li[data-action=home], .nav-btn-home").addClass("active-tab")}),$("li[data-action=home], .nav-btn-home").click(function(){setTimeout(function(){$("li[data-action=home], .nav-btn-home").addClass("active-tab")},500)}),$("li[data-action=discuss], .nav-btn-discuss").click(function(){setTimeout(function(){$("li[data-action=discuss], .nav-btn-discuss").addClass("active-tab")},500)}),$(".navigation-tabs li, .navigation-btn").click(function(){$(this).attr("data-action")&&($(".active-tab").removeClass("active-tab"),$(this).addClass("active-tab"))}),$(".follow-btn").mouseover(function(){$(this).hasClass("active-follow")&&$(this).text(t("Unfollow"))}),$(".follow-btn").mouseleave(function(){$(this).hasClass("active-follow")&&$(this).text(t("Following"))}),$("[data-activity]").click(function(){var e=$(this).attr("data-activity"),a=$(this).attr("data-id"),o=$(this).attr("data-author"),n=$(this).attr("data-selector");n||(n=this);var i=this;!0===(!("follow"===e&&$(this).hasClass("active-follow")||$(this).hasClass("unfollow-opt"))||confirm("Are you sure you want to unfollow this person?"))&&$.ajax({type:"POST",url:"/api/"+version+"/activity",dataType:"json",data:{what:e,content:a,target:o},success:function(a){var o=a.status,r=a.message,s=$(i).text();"success"===o?("request"!==e&&"follow"!==e&&$(n).html(r),"reply"!==e&&($(i).toggleClass("active-"+e),$(i).toggleClass("active-action")),"request"===e&&($(i).hasClass("icon-only-btn")||$(i).text(s==t("Follow")?t("Request Sent"):t("Follow"))),"follow"===e&&($(i).hasClass("icon-only-btn")||$(i).text(s==t("Follow")?t("Following"):t("Follow")),$(i).toggleClass("primary-btn"),$(i).toggleClass("grey-btn"))):newAlert(r)},error:function(e){console.log("error creating activity"),console.log(e)}})}),$("[data-remove]").click(function(){var e=$(this).attr("data-remove"),a=$(this).attr("data-id");!0===(!("follow"===e&&$(this).hasClass("active-follow")||$(this).hasClass("unfollow-opt"))||confirm(t("confirm-remove-follow")))&&$.ajax({type:"POST",url:"/api/"+version+"/ractivity",dataType:"json",data:{what:e,content:a},success:function(e){var t=e.status,a=e.message;"success"===t?console.log(a):newAlert(a)},error:function(e){console.log("error removing activity")}})}),$("[data-blacklist]").click(function(){var e=$(this).attr("data-blacklist"),a=$(this).attr("data-target");!0===confirm("Are you sure?")&&$.ajax({type:"POST",url:"/api/"+version+"/blacklist",dataType:"json",data:{type:e,target:a},success:function(e){var a=e.status,o=e.message;newAlert("success"===a?o:t("general-error-message"))},error:function(e){console.log("error creating activity")}})}),$("[data-dropdown]").on("click",function(e){$(".dropdown").fadeOut();var t=this;setTimeout(function(){var e=$(t).attr("data-dropdown"),a=$(t).attr("data-item");$(".dropdown#"+e).fadeIn(),$(".dropdowns-container").css("display","flex"),"post-menu"!==e&&"convo-menu"!==e&&"profile-menu"!==e&&"block-menu"!==e||(e=e.replace("-menu",""),$("."+e+"-opts-container").html("<div class='load white'></div>"),$("."+e+"-opts-container").addClass("inline-loading"),$.ajax({type:"POST",url:"/backend",data:{action:"menus",id:a,type:e},success:function(t){$("."+e+"-opts-container").removeClass("inline-loading"),$("."+e+"-opts-container").html(t),activate()},error:function(e){newAlert("Whoops! Error loading options.")}}))},500)}),$("[data-copy]").click(function(){copyText($(this).attr("data-copy"))}),$(".dropdowns-container").on("click",function(e){$(".dropdown").slideUp(),$(this).fadeOut()}),$(".delete-post").click(function(){modals("delete-post"),delete_id=$(this).attr("data-delete")}),$(".cancel-post-btn").click(function(){$(".modal#new-post h2").html(t("New Post")),reply_id=!1,repost_id=!1,$(".ref-post").html("")}),$(".reply-btn").click(function(){var e=$(this).attr("data-id"),a=$(this).attr("data-thread");reply_id=e,repost_id=!1,a&&(thread_id=a),$(".modal#new-post h2").html(t("Reply to...")),$(".ref-post").html("<div class='load'></div>"),$(".ref-post").addClass("inline-loading"),modals("new-post"),thread_id?($(".post-privacy").hide(),$(".reply-privacy").show()):($(".post-privacy").show(),$(".reply-privacy").hide()),$.ajax({type:"POST",url:"/backend",data:{action:"getPost",id:e},success:function(e){$(".ref-post").removeClass("inline-loading"),$(".ref-post").html(e),lazyLoad()},error:function(e){modals("new-post"),newAlert("Error loading the post you wanted to reply to.")}})}),$(".repost-btn").click(function(){var e=$(this).attr("data-id");repost_id=e,reply_id=!1,$(".modal#new-post h2").html(t("Repost to your profile")),$(".ref-post").html("<div class='load'></div>"),$(".ref-post").addClass("inline-loading"),modals("new-post"),$(".post-privacy").show(),$(".reply-privacy").hide(),$.ajax({type:"POST",url:"/backend",data:{action:"getPost",id:e},success:function(e){$(".ref-post").removeClass("inline-loading"),$(".ref-post").html(e),lazyLoad()},error:function(e){modals("new-post"),newAlert("Error loading the post you wanted to repost.")}})}),$(".message-btn").click(function(){}),$(".accept-btn, .decline-btn").click(function(){var e=$(this).attr("data-id"),t=$(this).attr("data-allow");$.ajax({type:"POST",url:"/api/"+version+"/remove",dataType:"json",data:{id:e,allow:t},success:function(e){e.status;newAlert(e.message),setTimeout(function(){load("activity")},100)},error:function(e){newAlert("Error doing stuff with activity.")}})}),$(".edit-post").click(function(){$("#edit-title").val(""),$("#edit-content").val(""),modals("edit-post");var e=$(this).attr("data-edit");$(".edit-container").html("<div class='load white'></div>"),$(".edit-container").addClass("inline-loading"),edit_id=e,$.ajax({type:"POST",url:"/api/"+version+"/edit",data:{id:e},success:function(e){var t=e.message,a=e.title,o=e.content;e.content?($("#edit-content").val(o),e.title?($("#edit-title").show(),$("#edit-title").val(a)):$("#edit-title").hide()):(setTimeout(function(){modals("edit-post")},100),newAlert(t))},error:function(e){setTimeout(function(){modals("edit-post")},100),newAlert("Error loading post for you to edit. Please try again later.")}})}),$(".pin-post").click(function(){var e=$(this).attr("data-id");$.ajax({type:"POST",url:"/api/"+version+"/pin",data:{id:e},success:function(e){e.status;newAlert(e.message)},error:function(e){modals("edit-post"),newAlert(t("Error loading post."))}})}),$("#content").on("click",function(){$(".post-btns-group").show()}),$("#new-thread-form").on("submit",function(e){var t=$("form#"+this.id).serialize();e.preventDefault(),$("#newthread-error").fadeOut(),$("#newthread-error").attr("class","message");var a=checkInputs(this.id),o=checkCount(this.id);!0===a&&!0===o?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/api/"+version+"/newThread",data:t,success:function(e){var t=e.status,a=e.message;$(":input, :button").prop("disabled",!1),"error"!==t?(window.onbeforeunload=null,confirmunload=!1,load("thread","id="+e.id,"/thread/"+e.id)):($("#newthread-error").addClass("error"),$("#newthread-error").html(a),$("#newthread-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#newthread-error").addClass("error"),$("#newthread-error").html("Oops! There was an error creating a thread, please try again later."),$("#newthread-error").fadeIn()}})):console.log("Required inputs are empty or an input is beyond it's character limit"),e.preventDefault()}),$(".save-btn").on("click",function(e){$("#user-settings-form").submit()}),$("#user-settings-form, #privacy-settings-form").on("submit",function(e){var t=$("form#"+this.id).serialize();e.preventDefault(),$("#settings-message").fadeOut(),$("#settings-message").attr("class","message");var a=checkInputs(this.id),o=checkCount(this.id);!0===a&&!0===o?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:t,success:function(e){$(":input, :button").prop("disabled",!1),e.includes("updated")?($("#updated").html(e),$("#settings-message").addClass("success"),$("#settings-message").html("Account changes saved!"),$("#settings-message").fadeIn(),setTimeout(function(){$("#settings-message").fadeOut()},3e3)):($("#settings-message").addClass("error"),$("#settings-message").html(e),$("#settings-message").fadeIn()),$("#settings-message").addClass("fixed-message")},error:function(e){$(":input, :button").prop("disabled",!1),$("#settings-message").addClass("error"),$("#settings-message").html("Oops! There was an error saving your changes, please try again later."),$("#settings-message").fadeIn()}})):console.log("Required inputs are empty or an input is beyond it's character limit"),e.preventDefault()}),$("#reset-password-form").on("submit",function(e){e.preventDefault(),$("#reset-error").fadeOut();var t=checkInputs(this.id),a=checkCount(this.id),o=$("form#"+this.id).serialize();!0===t&&!0===a?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:o,success:function(e){$(":input, :button").prop("disabled",!1),$("iframe").attr("src",$("iframe").attr("src")),"sent"===e?($("#email").val(""),$("#reset-success").html(e),$("#reset-success").fadeIn()):($("#reset-error").html(e),$("#reset-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#reset-error").html("Backend error, please try again later."),$("#reset-error").fadeIn()}})):(console.log("Required inputs are empty or an input is beyond it's character limit"),$(":input, :button").prop("disabled",!1)),e.preventDefault()}),$("#change-password-form").on("submit",function(e){e.preventDefault(),$("#password-error").fadeOut();var t=checkInputs(this.id),a=checkCount(this.id),o=$("form#"+this.id).serialize();!0===t&&!0===a?($(":input, :button").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:o,success:function(e){$(":input, :button").prop("disabled",!1),"reset"===e?(newAlert("Your password has been changed."),setInterval(function(){window.location="/settings/account"},3e3)):($("#password-error").html(e),$("#password-error").fadeIn())},error:function(e){$(":input, :button").prop("disabled",!1),$("#password-error").html("Backend error updating your account."),$("#password-error").fadeIn()}})):(console.log("Required inputs are empty or an input is beyond it's character limit"),$(":input, :button").prop("disabled",!1)),e.preventDefault()}),$(".edit-profile").click(function(){$("#avatarFile").click()}),$("#avatarFile").change(function(){var e=new FormData,t=$("#avatarFile")[0].files[0];e.append("action","avatars"),e.append("file",t);var a=new XMLHttpRequest;a.open("POST","/img/upload",!0),$(":input, :button").prop("disabled",!0),$(".indeterminate").hide(),$(".determinate").show(),$(".upload-photo").show(),a.upload.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;$(".progress-text").html("Uploading..."+Math.round(t)+"%"),$(".determinate").css("width",Math.round(t)+"%")}},a.onload=function(){if(200===this.status){var e=this.responseText;$(":input, :button").prop("disabled",!1),$(".upload-photo").hide(),console.log(e),"badext"===e?newAlert("Only .jpeg, .png and .gif files are allowed."):"toolarge"===e?newAlert("Your file is too large for us (yourimage > 500 MB)"):e.includes("error")?newAlert("We couldn't upload that photo for some reason, please try again later."):(newAlert("Avatar updated! Lookin' good!"),$("#edit-val-image").val(e),saveEdit("image",!0),setTimeout(function(){window.location=window.location.href},1e3)),("badext"===e||"toolarge"===e||e.includes("error"))&&activate()}else console.log("goofed"),$(":input, :button").prop("disabled",!1),$(".upload-photo").hide(),newAlert("We couldn't upload that photo for some reason, please try again later.")},a.send(e)}),$("#message-content").on("input",function(){$("#message-content").val()?$(".send-msg-btn").prop("disabled",!1):$(".send-msg-btn").prop("disabled",!0)}),$(".send-msg-btn").click(function(){$(":input, :button").prop("disabled",!0),$("#newmessage-error").fadeOut();var e=$("#message-content").val(),t=$(this).attr("data-id"),a=guidGenerator();addMessage(a,t,e),e&&$.ajax({type:"POST",url:"/api/"+version+"/message",dataType:"json",data:{id:a,convo:t,content:e},success:function(e){var o=e.status,n=e.message;$(":button, :input").prop("disabled",!1),"success"===o?(addMessage(a,t),scrollMessages(),$("#message-content").val("")):($("#newmessage-error").html(n),$("#newmessage-error").fadeIn())},error:function(e){console.log("error creating new convo"),$("#newmessage-error").html("There was an error creating a new conversation."),$("#newmessage-error").fadeIn()}})}),"messages"===e&&($("body").addClass("hinder"),ismobile&&$(".new-post").fadeOut(),loadConversation(!1,!0),setInterval(function(){loadConversation()},2500)),$(".posts-container").html()||"home"===e&&content(".posts-container","feed","type=home&weeks=1"),$(".activity-container").html()||"activity"===e&&content(".activity-container","activity"),$(".threads-container").html()||"created"===e&&content(".threads-container","threads","type=created"),$(".threads-container").html()||"favorites"===e&&content(".threads-container","threads","type=favorites")}function lazyLoad(){!function(e){function t(e,t){if(e.getAttribute("data-src")){var a=new Image,o=e.getAttribute("data-src");a.onload=function(){e.parent?e.parent.replaceChild(a,e):e.src=o,t&&t()},a.src=o}else{a=new Image,o=e.getAttribute("data-background");a.onload=function(){e.parent?e.parent.replaceChild(a,e):$(e).css("background-image","url("+o+")"),t&&t()},a.src=o}}for(var a=new Array,o=function(e,t){if(document.querySelectorAll)t=document.querySelectorAll(e);else{var a=document,o=a.styleSheets[0]||a.createStyleSheet();o.addRule(e,"f:b");for(var n=a.all,i=0,r=[],s=n.length;i<s;i++)n[i].currentStyle.f&&r.push(n[i]);o.removeRule(0),t=r}return t}("[data-src],[data-background]"),n=function(){for(var o=0;o<a.length;o++)n=a[o],i=void 0,(i=n.getBoundingClientRect()).top>=0&&i.left>=0&&i.top<=(e.innerHeight||document.documentElement.clientHeight)&&t(a[o],function(){a.splice(o,o)});var n,i},i=0;i<o.length;i++)a.push(o[i]);n(),function(t,a){e.addEventListener?this.addEventListener(t,a,!1):e.attachEvent?this.attachEvent("on"+t,a):this["on"+t]=a}("scroll",n)}(this)}var request=new XMLHttpRequest;request.open("GET","/translations/"+lang+".json",!1),request.send(null);var edit_id,delete_id,localize=JSON.parse(request.responseText);function t(e){return localize[e]?localize[e]:e}function deletePost(){$.ajax({type:"POST",url:"/api/"+version+"/deletePost",dataType:"json",data:{id:delete_id},success:function(e){var t=e.status;newAlert(e.message),"success"===t&&($(".post#post-"+delete_id).slideUp(),setTimeout(function(){$("#post-"+delete_id).remove()},1e3))},error:function(e){newAlert("Error deleting post.")}})}function savePost(){var e=$("#edit-content").val(),t=$("#edit-title").val();$.ajax({type:"POST",url:"/api/"+version+"/updatePost",dataType:"json",data:{id:edit_id,title:t,content:e},success:function(e){var t=e.status;newAlert(e.message),"success"===t&&(window.location=window.location.href)},error:function(e){newAlert("Error removing post.")}})}function copyText(e){var t=$("<input/>");$("body").append(t),t.val(e).select(),document.execCommand("copy"),t.remove(),newAlert("Copied to clipboard!")}function getCookie(e){var t=document.cookie,a=t.indexOf(" "+e+"=");if(-1==a&&(a=t.indexOf(e+"=")),-1==a)t=null;else{a=t.indexOf("=",a)+1;var o=t.indexOf(";",a);-1==o&&(o=t.length),t=unescape(t.substring(a,o))}return t}function setCookie(e,t,a){var o=new Date;o.setDate(o.getDate()+a);var n=escape(t)+(null===a?"":"; expires="+o.toUTCString())+";path=/";document.cookie=e+"="+n}function eraseCookie(e){document.cookie=e+"=; Max-Age=0"}function showMessage(e,t=!0,a=!1,o=!1,n=!0,i=3e3){if(e){var r=".message#"+e;3e3!==i&&(i+="000"),!1!==o&&($(r).attr("class","message"),$(r).addClass(o)),!1!==a&&$(r).html(a),!0===t?$(r).fadeIn():$(r).fadeOut(),!1!==n&&setTimeout(function(){$(r).fadeOut()},i)}}function confirmLogout(){!0===confirm("Are you sure you want to log out?")&&(window.location.href="/accounts/logout")}function checkInputs(e){var t;if("submission-form"===e)var a="<p></p>";return $("form#"+e+" input, form#"+e+" textarea").each(function(){"true"!=$(this).attr("data-require")||$(this).val()?(console.log("true"),$(this).removeClass("require-input"),$("#error-"+this.id).fadeOut(),"false"!==t&&(t="true")):(console.log("false"),$(this).addClass("require-input"),$("#error-"+this.id).length?$("#error-"+this.id).fadeIn():a?$(this).after(a+"<br/><div class='require-error' id='error-"+this.id+"'>This field is required</div>"):$(this).after("<br/><div class='require-error' id='error-"+this.id+"'>This field is required</div>"),t="false"),++field_count}),console.log("all required inputs are filled: "+t),"true"===t}function removeValue(e,t){return e.replace(new RegExp(",?"+t+",?"),function(e){return","===e.charAt(0)&&","===e.charAt(e.length-1)?",":""})}function checkCount(e){var t;return $("form#"+e+" input, form#"+e+" textarea").each(function(){if($(this).attr("data-limit")<$(this).val().length){var e=$(this).attr("data-limit");$(this).addClass("require-input"),$("#error-limit"+this.id).length?$("#error-limit"+this.id).fadeIn():$(this).after("<br/><div class='require-error' id='error-limit"+this.id+"'>Field must be under "+e+" characters</div>"),t="false"}else $(this).removeClass("require-input"),$("#error-limit"+this.id).fadeOut(),"false"!==t&&(t="true")}),"true"===t}function getValue(e){var t=window.location.href.replace(new RegExp("\\+","g"),"%20").split("?");if(0==t.length)return"";var a=t[1].split("&"),o="";for(i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]==e){o=n[1];break}}return(o=unescape(o)).replace("+"," "),o}function scrollOn(e,t=0,a=0){if(!1===e.includes("."))e="#"+e;$("html,body").animate({scrollTop:$(e).offset().top+t-a})}function guidGenerator(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function goTo(e,t){t?window.open(e,"_blank").focus():window.location=e}function newAlert(e){var t=guidGenerator();$(".alert-feed").append("<div><div class='alert' id='alert-"+t+"'>"+e+"</div></div>"),setTimeout(function(){$(".alert#alert-"+t).slideDown(),setTimeout(function(){$(".alert#alert-"+t).addClass("active-alert")},1e3),setTimeout(function(){$(".alert#alert-"+t).removeClass("active-alert"),$(".alert#alert-"+t).slideUp(),setTimeout(function(){$(".alert#alert-"+t).remove()},500)},5e3)},100)}function colEdit(e,t){$(".dashboard-navigation").addClass("disable-this"),t&&$("#edit-val-"+e).show(),$("#column-value-"+e).removeClass("save-flash"),$("#column-"+e).addClass("active-column"),$(".edit-column-container:not(.active-column)").addClass("inactive-column"),$("#edit-btn-"+e).hide(),$("#context-"+e).show(),$("#save-btn-"+e).show(),$("#cancel-btn-"+e).show(),$(".edit-column-change#change-"+e).show(),$("#column-value-"+e).hide(),$("#edit-val-"+e).focus(),$(".edit-column-btn").prop("disabled",!0)}function columnError(e,t){$("#edit-val-"+t).addClass("require-input"),$("#error-"+t).is(":visible")?($("#error-"+t).html(e),$("#error-"+t).fadeIn()):$("#edit-val-"+t).after("<p class='require-error' id='error-"+t+"'>"+e+"</p>")}function saveEdit(e,t){$("#error-"+e).fadeOut();var a=$("#edit-val-"+e).val();a||"displayname"!==e&&"username"!==e&&"email"!==e?($(":button, :input").prop("disabled",!0),$.ajax({type:"POST",url:"/accounts/auth",data:{action:"save",column:e,value:a},success:function(o){console.log(o),"taken"===o?(columnError("Sorry, someone beat you to that one!",e),$(":button, :input").prop("disabled",!1)):!1===o.includes("error")?(cancelEdit(e,t),(a=o)?("user_name"===e?($("#column-value-"+e).html("<a href='/page/"+a+"' target='_blank'>whatzup.com/page/"+a+"</a>"),$("#pagelink").attr("href","/page/"+a)):"hours"===e?(load("account"),newAlert("Wham-o! Settings saved.")):("extraurl"===e&&(a="<a href='"+o+"' target='_blank' rel='noopener'>"+o+"</a>"),$("#column-value-"+e).html(a)),"performer"===e?$(".fade-title").html(a):"user_name"===e&&$(".fade-username").html("@"+a)):$("#column-value-"+e).html("<span class='fade'>Nothing here yet...</span>"),$("#edit-val-"+e).addClass("save-flash"),$(":button, :input").prop("disabled",!1)):(columnError(o,e),$(":button, :input").prop("disabled",!1))},error:function(t){$(".dashboard-navigation").removeClass("disable-this"),console.log(t),cancelEdit(e),$("#column-value-"+e).html("<span style='color: #de2233;'>Backend error saving, please contact us by going to the help & support tab</span>"),$(":button, :input").not("#hours-container input").prop("disabled",!1)}})):columnError("This field is required.",e)}function cancelEdit(e){$(".require-error").fadeOut();$("#column-value-"+e).html();$("#edit-val-"+e).removeClass("require"),$(".edit-column-btn").prop("disabled",!1),$(".edit-column-container").removeClass("inactive-column"),$("#column-"+e).removeClass("active-column"),$(".dashboard-navigation").removeClass("disable-this")}function userSearch(){$("#usersearch-error").fadeOut();var e=$("#user-search").val();$.ajax({type:"POST",url:"/backend",data:{action:"list",type:"messages",query:e},success:function(e){$(".user-list").html(e),$(".user-item").click(function(){}),$("#user-search").on("change",function(e){userSearch()}),$(".add-user-btn").on("click",function(e){var t,a=$(this).attr("data-id"),o=$("#convo-users").val();t=o?o.includes(a)?removeValue(o,a):o+","+a:a,$("#convo-users").val(t);var n=$(this).text();$(this).hasClass("grey-btn")?$(this).text("Invite"==n?"Added":"Invite"):$(this).text("Add"==n?"Added":"Add"),$(this).toggleClass("active-add"),$("#convo-users").val()?$(".new-convo-btn").prop("disabled",!1):$(".new-convo-btn").prop("disabled",!0)}),lazyLoad(),activate()},error:function(e){$("#usersearch-error").fadeIn()}})}function loadConversation(e,t){e?current_convo=e:e=current_convo,$.ajax({type:"POST",url:"/backend",data:{action:"messages",id:e},success:function(e){e&&($(".messages-container").html(e),activate(),t&&scrollMessages())},error:function(e){console.log("error loading messages")}})}